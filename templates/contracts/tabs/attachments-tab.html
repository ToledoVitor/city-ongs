{% extends "contracts/tab_base.html" %}
{% load humanize %}

{% block tab_content %}
<div class="relative overflow-x-auto shadow-md sm:rounded-lg">
    <table class="w-full text-sm text-left rtl:text-right text-gray-400">
        <thead class="text-xs text-white uppercase bg-gray-500">
            <tr>
                <th scope="col" class="px-6 py-3" />
                <th scope="col" class="px-6 py-3 text-left">
                    Nome
                </th>
                <th scope="col" class="px-6 py-3 text-left">
                    Tipo
                </th>
                <th scope="col" class="px-6 py-3 text-left">
                    Data
                </th>
            </tr>
        </thead>
        <tbody>
            {% if contract.attachments.count %}
                {% for attachment in contract.attachments.all %}
                    <tr class="border-b bg-gray-200 border-gray-700 hover:bg-gray-400 text-center">
                        <td scope="row" class="flex justify-center align-center py-4 text-sm whitespace-nowrap text-black">
                            <button
                                type="button"
                                data-modal-target="attachments-{{ attachment.id}}"
                                data-modal-toggle="attachments-{{ attachment.id}}"
                                class="
                                    text-white
                                    ml-2
                                    bg-blue-600
                                    hover:bg-blue-600
                                    focus:ring-4
                                    focus:outline-none
                                    focus:ring-blue-600
                                    font-medium
                                    rounded-full
                                    text-sm
                                    p-2.5
                                    text-center
                                    inline-flex
                                    items-center
                                    me-2
                                "
                            >
                                <svg class="w-[20px] h-[20px] text-white" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" viewBox="0 0 24 24">
                                    <path fill-rule="evenodd" d="M11.32 6.176H5c-1.105 0-2 .949-2 2.118v10.588C3 20.052 3.895 21 5 21h11c1.105 0 2-.948 2-2.118v-7.75l-3.914 4.144A2.46 2.46 0 0 1 12.81 16l-2.681.568c-1.75.37-3.292-1.263-2.942-3.115l.536-2.839c.097-.512.335-.983.684-1.352l2.914-3.086Z" clip-rule="evenodd"/>
                                    <path fill-rule="evenodd" d="M19.846 4.318a2.148 2.148 0 0 0-.437-.692 2.014 2.014 0 0 0-.654-.463 1.92 1.92 0 0 0-1.544 0 2.014 2.014 0 0 0-.654.463l-.546.578 2.852 3.02.546-.579a2.14 2.14 0 0 0 .437-.692 2.244 2.244 0 0 0 0-1.635ZM17.45 8.721 14.597 5.7 9.82 10.76a.54.54 0 0 0-.137.27l-.536 2.84c-.07.37.239.696.588.622l2.682-.567a.492.492 0 0 0 .255-.145l4.778-5.06Z" clip-rule="evenodd"/>
                                </svg>
                            </button>

                            {% if not user.is_committee_member %}
                                <a
                                    href="{% url 'contracts:contracts-attachments-update' contract.id attachment.id %}"
                                    class="
                                        ml-4
                                        px-3
                                        py-2
                                        text-sm
                                        font-medium
                                        text-center
                                        inline-flex
                                        items-center
                                        text-white
                                        rounded-lg
                                        focus:ring-4
                                        focus:outline-none
                                        bg-blue-600
                                        hover:bg-blue-700
                                        focus:ring-blue-800
                                    "
                                >
                                    Editar
                                </a>
                            {% endif %}
                        </td>

                        <td class="px-6 py-4 text-sm text-black text-left">
                            {{ attachment.name }}
                        </td>

                        <td class="px-6 py-4 text-sm text-black text-left">
                            {{ attachment.type_label }}
                        </td>

                        <td class="px-6 py-4 text-sm text-black text-left">
                            {{ attachment.created_at|date:"d/m/Y H:i" }}
                        </td>
                    </tr>

                    <div
                        id="attachments-{{ attachment.id}}"
                        tabindex="-1"
                        data-modal-backdrop="static"
                        aria-hidden="true"
                        class="
                            hidden
                            overflow-y-auto
                            overflow-x-hidden
                            fixed
                            top-0
                            right-0
                            left-0
                            z-50
                            justify-center
                            items-center
                            w-full
                            md:inset-0
                            h-[calc(100%-1rem)]
                            max-h-full
                        "
                    >
                        <div class="relative p-4 w-full max-w-md max-h-full">
                            <!-- Modal content -->
                            <div class="relative rounded-lg shadow bg-gray-300">
                                <!-- Modal header -->
                                <div class="flex items-center justify-between p-4 md:p-5 border-b rounded-t border-gray-600">
                                    <h3 class="text-xl font-semibold text-black">
                                        Comentar Anexo
                                    </h3>
                                    <button
                                        type="button"
                                        data-modal-hide="attachments-{{ attachment.id}}"
                                        class="
                                            end-2.5
                                            text-black
                                            hover:bg-gray-600
                                            hover:text-black
                                            bg-transparent
                                            rounded-lg
                                            text-sm
                                            w-6
                                            h-6
                                            ms-auto
                                            inline-flex
                                            justify-center
                                            items-center
                                        "
                                    >
                                        <svg class="w-3 h-3" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 14 14">
                                            <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m1 1 6 6m0 0 6 6M7 7l6-6M7 7l-6 6"/>
                                        </svg>
                                        <span class="sr-only">Fechar modal</span>
                                    </button>
                                </div>
                                <!-- Modal body -->
                                <div class="p-4 md:p-5">
                                    <form class="space-y-4" method="post" action="{% url 'contracts:contracts-detail' contract.id %}">
                                        <input type="hidden" name="csrfmiddlewaretoken" value="{{ csrf_token }}">
                                        <input type="hidden" name="form_type" value="attachments_modal">
                                        <input type="hidden" name="attachment_id" value="{{ attachment.id }}">

                                        <div>
                                            <label for="comment" class="block mb-2 text-sm font-medium text-black">Comentário</label>
                                            <textarea
                                                id="comment"
                                                name="comment"
                                                rows="4"
                                                class="block p-2.5 w-full text-sm text-black rounded-lg border border-gray-600 focus:ring-blue-500 focus:border-blue-500 bg-gray-200"
                                                placeholder="Digite seu comentário aqui..."
                                            ></textarea>
                                        </div>

                                        {% if user.can_change_statuses %}
                                            <div>
                                                <label for="status" class="block mb-2 text-sm font-medium text-black">Status</label>
                                                <select
                                                    id="status"
                                                    name="status"
                                                    class="bg-gray-200 border border-gray-600 text-black text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5"
                                                >
                                                    {% for status in attachment.status_choices %}
                                                        <option value="{{ status.0 }}" {% if attachment.status == status.0 %}selected{% endif %}>
                                                            {{ status.1 }}
                                                        </option>
                                                    {% endfor %}
                                                </select>
                                            </div>
                                        {% endif %}

                                        <div class="grid gap-6 my-6 md:grid-cols-2">
                                            <button
                                                type="button"
                                                data-modal-hide="attachments-{{ attachment.id}}"
                                                class="
                                                    w-full
                                                    text-white
                                                    bg-gray-700
                                                    hover:bg-gray-800
                                                    focus:ring-4
                                                    focus:outline-none
                                                    focus:ring-gray-300
                                                    font-medium rounded-lg
                                                    text-sm
                                                    px-5
                                                    py-2.5
                                                    text-center
                                                "
                                            >
                                                Cancelar
                                            </button>
                                            <button
                                                type="submit"
                                                class="
                                                    w-full
                                                    text-white
                                                    bg-blue-700
                                                    hover:bg-blue-800
                                                    focus:ring-4
                                                    focus:outline-none
                                                    focus:ring-blue-300
                                                    font-medium rounded-lg
                                                    text-sm
                                                    px-5
                                                    py-2.5
                                                    text-center
                                                "
                                            >
                                                Salvar
                                            </button>
                                        </div>
                                    </form>
                                </div>
                            </div>
                        </div>
                    </div>
                {% endfor %}
            {% else %}
                <tr class="border-b bg-gray-200 border-gray-700 hover:bg-gray-400">
                    <th scope="row" class="px-6 py-4 font-medium whitespace-nowrap text-black">
                        Nenhum resultado
                    </th>
                    <td class="px-6 py-4">
                        -
                    </td>
                    <td class="px-6 py-4">
                        -
                    </td>
                    <td class="px-6 py-4">
                        -
                    </td>
                </tr>
            {% endif %}
        </tbody>
    </table>

    {% if not contract.is_finished %}
        <div class="flex items-center flex-column flex-wrap md:flex-row justify-end pt-2 pb-4 px-4 bg-gray-200">
            <a
                href="{% url 'contracts:contracts-attachments-create' contract.id %}"
                class="
                    px-3
                    py-2
                    text-sm
                    font-medium
                    text-center
                    inline-flex
                    items-center
                    text-white
                    rounded-lg
                    focus:ring-4
                    focus:outline-none
                    bg-blue-600
                    hover:bg-blue-700
                    focus:ring-blue-800
                "
            >
                Adicionar Anexo
                <svg class="w-[16px] h-[16px] text-white ml-2" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24">
                    <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 12h14m-7 7V5"/>
                </svg>
            </a>
        </div>
    {% endif %}
</div>
{% endblock %} 